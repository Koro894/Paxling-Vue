<template>
    <div class="user_xolst">
        <h1 class="info_iser_h1">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
        <a class="user_logo"><img src="./user.png" alt="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" /></a>
        <h2 class="name_user">–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω : </h2>
        <input type="text" v-model="user_name" class="inp_rega" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω..."/>
        <h3 v-if="user_name.length <= 5">–ù–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤</h3>
        <h3 v-else-if="user_name.length >= 5 && user_name.length <= 100">–ù–µ –±–æ–ª–µ–µ 100 —Å–∏–º–≤–æ–ª–æ–≤</h3>
        <h3 v-else-if="user_name.length >= 100" :enabled="is_proverk=true">–í—ã –ø—Ä–∏–≤—ã—Å–∏–ª–∏ 100 —Å–∏–º–≤–æ–ª–æ–≤!!!</h3>
        <h2 class="name_user">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å : </h2>
        <h2 class="name_user" style="color: #d11818; font-size: 20px;">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ. –ü–æ–∂–∞–π–ª—É—Å—Ç–∞, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞ –Ω–æ–≤—ã–π <br> –ø–∞—Ä–æ–ª—å, —Ç–∞–∫ –∫–∞–∫ –Ω–∞ —ç—Ç–æ–º —Å–∞–π—Ç–µ –Ω–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª "http://" <br> –∏ –Ω–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–µ –ª—é–¥–∏ –º–æ–≥—É—Ç —É –≤–∞—Å —É–∫—Ä–∞—Å—Ç—å –ø–∞—Ä–æ–ª—å. <br> –ù–∞ –¥—Ä—É–≥–∏—Ö –∂–µ —Å–∞–π—Ç–∞—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª "htpps://" - –æ–Ω –±–æ–ª–µ–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π.</h2>
        <input type="password" v-model="user_password" class="inp_rega" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..."/>
        <h3 v-if="user_password.length <= 5">–ù–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤</h3>
        <h3 v-else-if="user_password.length >= 5 && user_password.length <= 100">–ù–µ –±–æ–ª–µ–µ 100 —Å–∏–º–≤–æ–ª–æ–≤</h3>
        <h2 class="name_user" >–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) : </h2>
        <textarea type="text" v-model="user_descript" class="inp_opusan" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 2000 —Å–∏–º–≤–æ–ª–æ–≤! ..."></textarea>
        <h4 v-if="user_descript.length <= 2000">{{ user_descript.length }}/2000</h4>
        <h2>–í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ—ë –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ <br>(—Å–µ–π—á–∞—Å —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞,<br> –¥–∞–∂–µ –Ω–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å ‚ÄÇ  üòë ‚ÄÇ )</h2>
        <input type="file" class="get_image" accept="image/*" name="file"/>
        <button class="public_user" @click="reustor_user">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        <h2>{{ _Auth }}</h2>

    </div>
</template>

<style scoped>
@import "./regustr.css";
</style>

<script setup>
import axios from 'axios';
import { ref } from 'vue';
import { useRouter } from 'vue-router';

const router = useRouter();

// –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
const is_proverk = ref(false);
const _Error = ref('');
const user_name = ref('');
const user_password = ref('');
const user_descript = ref('');
const _Auth = ref('');
const Bool_Auth = ref(false);



// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
const reustor_user = async () => {
  try {
    const response = await axios.post('http://127.0.0.1:8010/users/sign_regustrat', {
      user: user_name.value,
      password: user_password.value,
      description: user_descript.value
    });

    if (response.status === 200) {
      const token = response.data.token;
      const id_ = response.data.id;
      console.log(token);
      console.log(id_);
      
      localStorage.setItem('jwtToken', token);
      _Auth.value = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!';
      Bool_Auth.value = true;
      
      router.push(`/user/${id_}`);
    }
  } catch (error) {
    _Auth.value = error.response?.data?.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
    Bool_Auth.value = false;
  }
};
</script>